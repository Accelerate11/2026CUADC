####这个日志偏向于日记，感兴趣的可以看一下，更为精简偏技术路线的日志也会发布####


##寒假培训之后并没有开展特别多的工作，电脑配置了一套往年的双系统，配置过程相对顺畅，但是在使用过程中非常的难受，由于Ubuntu20.04对网卡驱动有一定的要求，而我的电脑正好是那一代无法使用的，解决方法只有更换电脑网卡版，遂直接更换几年赛季的驱动，配置正式升级为Ubuntu22.04，ROS2 humble


##年前依靠大创组里面充足的经费（乐）拿到了两个x7飞控，进行了基础的学习，主要学了固件的烧写和与机载电脑的通讯原理，年前也相对系统地学习了一下ROS2，看了半本书和几节课，都是鱼佬的，鱼佬的课的特点是python和C++同时展开讲解，python那个方便理解，毕竟代码简单，但是我们比赛还是用C++，下个学期的专业课正好是这个，就一起学了。


##2026.2.16，新年快乐，chatGLM开放了agent模式，探索性使用过后觉得非常好用，在后续的备赛阶段要批判的使用。


##2026.2.18，搞了两天的gazebo仿真（参考往年技术文档中的“如何在gazebo中自定义模型与地图”），并配合chatGLM完成了一个比较清晰的技术文档书写方便新会员使用和学习。这个仿真的技术路线还是比较清晰的，当基础仿真环境搭建好之后，接下来的任务就是导入三个模型插件：“世界插件”、“模型插件”、“传感器插件”（传感器插件我不确定用不用）；鉴于我们的飞控固件选择，我们需要在仿真环境导入apm固件，在“ROS2_Humble_Gazebo_APM无人机仿真配置教程”中第四节有详细解读。

##SDF（Simulation Description Format）是Gazebo使用的模型描述格式，定义了机器人的物理结构、视觉外观和传感器配置。在windows系统中并没有发现可靠的预览这个格式文件的软件（csdn说可以用什么vismod来看，但是我这边下载了也打不开），另一个莫名其妙的事是我电脑上默认打开sdf文件的软件居然是我的Altium Designer。当然在ROS环境中就简单多了，ROS自带的rviz可以预览sdf文件。
##MAVROS是MAVROS是MAVLink协议的ROS接口，用于实现ROS与ArduPilot之间的通信。Link协议的ROS接口，用于实现ROS与ArduPilot之间的通信。，这个是一个比较重要的通讯；MAV就是“micro aie vehicle"的缩写，代表微型航空器。这个过程在文档5.3节有书写。
##另一个重要的模块是blender的使用，他可建模、可贴图还⽀持ubuntu，所以比较友好，去年的技术文档里面有现成的模型，直接使用就好了
##我们要验证的飞行代码是code1.cpp（没找到的看这里：多旋翼无人机技术文档\状态机代码\cadc_quad_state_machine\src\code1.cpp）接这按照文档里面的做就行，我们验证自己的代码，不用管文档中那一段，当然了要是有更好的想法也可以重新写一下。

##发现gazebo仿真的版本问题，如果你的cmake ..一直报错，大概率是没有指定gezebo版本，新的文档更改了这个地方
##建议双系统安装微信，在浏览器里面搜微信就行，选择linux的微信，一般都是X86架构，不放心就用“uname -m”查一下，然后选择deb格式的软件包（适用于Ubuntu），在下载目录下新建终端，用 sudo dpkg -i 你的压缩包名称 命令解压缩安装。
##别忘了你的AI在双系统里面同样可以使用


##2026.2.19chatGLM写的文档有很多问题，目前gazebo仿真停滞，重新更正错误，仅出现了一个好的画面，包括简化gazebo模型、飞控信息、地图
# 一、今日操作中遇到的全量问题汇总
结合今日完整操作链路与报错信息，遇到的问题可分为6大类，均为仿真环境搭建与代码验证的核心阻塞点，具体如下：
## 1. 飞控与仿真通信核心链路完全失效，持续`link 1 down`
- **核心现象**：ArduCopter飞控程序启动后，始终显示`link 1 down`，无法与Gazebo仿真环境建立UDP通信，无法获取传感器数据，飞控无法完成EKF初始化、GPS锁定，最终停留在`Waiting for connection`状态，无法进入可飞行状态。
- **直接诱因**：教程启动时序设计错误，引导先启动飞控再启动Gazebo，飞控发起9002/9003端口连接时，Gazebo还未完成端口监听，且教程未说明飞控的重连机制，导致链路永久断开。
## 2. Gazebo仿真启动完全异常，模型加载持续失败
- **现象1：Gazebo窗口完全无法弹出**：执行教程4.3节的`sim_vehicle.py`一键启动命令后，无任何Gazebo可视化窗口弹出，仅飞控程序单独运行。
- **现象2：模型显示异常**：手动启动Gazebo后，仅能显示简化圆柱体机身，无法加载官方iris四旋翼完整模型，无旋翼、机身3D结构。
- **现象3：启动报错频发**：Gazebo启动时持续出现`Plugin not found`、`模型找不到`、`Unable to find shader lib`等红色报错，插件与渲染资源加载完全失败。
- **核心根源**：教程未说明`sim_vehicle.py`脚本拉起Gazebo强依赖`run_gazebo.sh`启动脚本，既未提供该脚本的创建方法，也未说明模型/插件的路径配置规则。
## 3. ROS2工作空间colcon编译全链路失败，多次触发致命报错
- **问题1：重复功能包名冲突**：colcon检测到`ardupilot_dds_tests`、`ardupilot_msgs`、`ardupilot_sitl`等ROS包，在工作空间根目录和`src/`目录下重复存在，直接终止编译。
- **问题2：依赖缺失编译失败**：`ardupilot_sitl`包编译时提示`Could not find the program ['microxrceddsgen']`，教程完全未提及该DDS依赖的安装步骤。
- **问题3：权限不足编译终止**：`ardupilot_sitl_gazebo`插件编译时，触发`Permission denied`报错，无法向`/usr/lib/`系统目录复制插件文件，编译直接失败。
- **核心根源**：教程违背ROS2工作空间官方规范，错误引导将ArduPilot固件源码、ArduPilot_Gazebo系统插件放入ROS2工作空间`src/`目录，导致colcon递归扫描编译时出现一系列冲突与权限问题。
## 4. 环境变量配置持续报错，bashrc终端环境加载失效
- **问题1：语法错误导致路径完全失效**：教程4.2节的`GAZEBO_MODEL_PATH`配置存在文本截断，复制后导致bash语法错误，路径无限循环叠加，每次加载bashrc都会触发`没有那个文件或目录`报错。
- **问题2：无容错处理的source命令**：教程2.4节引导将`source ~/drone_sim_ws/install/setup.bash`直接写入bashrc，但未做文件存在性判断，删除install目录后，每次打开终端都会触发文件不存在报错。
- **问题3：路径配置不严谨**：教程4.1节的ArduPilot环境变量路径未做严格校验，路径变更后直接触发补全脚本找不到的报错。
- **问题4：加载优先级完全错误**：教程先配置自定义模型/插件路径，再加载Gazebo官方`setup.bash`，导致自定义路径被官方脚本覆盖，Gazebo永远找不到模型和插件。
## 5. 模型与世界文件持续缺失，教程引导的操作完全无法执行
- **核心现象**：按教程引导从ArduPilot_Gazebo仓库复制`iris`模型和`iris.world`世界文件时，持续触发`没有那个文件或目录`报错，复制操作完全无法执行。
- **根源**：ArduPilot_Gazebo官方仓库内，带完整ArduPilot插件配置的模型名为`iris_with_ardupilot`、世界文件名为`iris_with_ardupilot.world`，教程完全未说明该命名差异，也未提供重命名步骤，与仓库实际内容完全不符。
## 6. 自动飞行代码验证的前置环境始终无法就绪
- **核心现象**：仿真全链路始终无法打通，MAVROS无法与飞控建立心跳连接，`/mavros/state`话题始终显示`connected: false`，无法进入C++自动飞行代码的验证环节。
- **根源**：教程6.2节的启动流程未明确各终端的启动等待条件，未说明必须等飞控显示`Ready to FLY`后才能启动MAVROS，用户按教程顺序执行时，飞控未初始化完成就启动MAVROS，必然导致连接失败。

---

# 二、教程中存在的所有错误与设计缺陷
结合教程原文与实际操作结果，该教程存在**4大类、14项致命错误与设计缺陷**，是你今日所有问题的核心根源，具体如下：

## 一、致命文本截断与语法错误，直接导致环境完全失效
1.  **4.2节Gazebo环境变量存在致命文本截断**
    教程原文给出的配置：`export GAZEBO_MODEL_PATH=$ARDUPILOT_ROOT/Tools/simulation/gazebo-classic/models:$HOME/drone_sim_ws/src/ArduPilot_Gazebo/models:$GAZE`
    - 错误点：行尾`$GAZE`是`$GAZEBO_MODEL_PATH`的严重文本截断，用户复制后直接触发bash语法错误，路径配置完全失效，Gazebo永远找不到模型和插件，这是你环境变量报错的核心根源。
    - 附加错误：教程完全未说明环境变量的加载优先级，必须先加载Gazebo官方`setup.bash`，再配置自定义路径，否则自定义路径会被官方脚本覆盖，教程的配置顺序完全颠倒。
2.  **bashrc配置无任何容错处理**
    教程2.4节、4.1节引导将`source ~/drone_sim_ws/install/setup.bash`、ArduPilot补全脚本的source命令直接写入bashrc，但未添加任何文件存在性判断。
    - 错误点：当用户删除install目录、或ArduPilot路径变更时，每次打开终端都会触发`没有那个文件或目录`的报错，直接导致终端环境失效，教程完全未考虑该高频容错场景。

## 二、违背官方规范的设计错误，直接导致编译全链路失败
1.  **错误引导ArduPilot固件的存放位置，违背ROS2工作空间规范**
    教程4.1节引导将ArduPilot固件源码克隆到`~/drone_sim_ws/src/`目录（ROS2工作空间源码目录），这是完全违背官方规范的操作。
    - 错误点：ArduPilot固件内部`Tools/ros2/`目录下自带多个ROS2功能包，教程完全未说明需要添加`COLCON_IGNORE`文件让colcon跳过编译，直接导致你执行colcon build时出现重复包名、依赖缺失、编译失败等一系列问题。
    - 官方规范：ArduPilot固件应使用waf工具独立编译，禁止放入ROS2工作空间src目录被colcon扫描。
2.  **错误引导ArduPilot_Gazebo插件的编译安装方式**
    教程4.2节先引导将ArduPilot_Gazebo克隆到`~/drone_sim_ws/src/`目录，再用cmake+make+sudo make install安装，完全违背ROS2与Gazebo插件的安装规范。
    - 错误点1：放入src目录后，colcon会将其识别为ROS功能包，但其CMakeLists.txt的安装目标是系统级目录`/usr/lib/`，普通用户执行colcon build无sudo权限，直接触发`Permission denied`编译失败。
    - 错误点2：教程未说明该插件是Gazebo系统级插件，应放在ROS工作空间外单独编译安装，而非放入src目录，这是你插件编译失败的直接原因。
3.  **缺失关键依赖的安装说明**
    教程完全未说明编译ArduPilot内置ROS2包需要`microxrceddsgen`DDS代码生成工具，也未提供该依赖的安装步骤，用户直接编译必然触发`Could not find the program ['microxrceddsgen']`报错。

## 三、关键流程与依赖缺失，导致仿真启动必然失败
1.  **核心启动脚本完全缺失，未做任何说明**
    教程4.3节直接给出`sim_vehicle.py`一键启动命令，但完全未说明该命令拉起Gazebo强依赖`Tools/simulation/gazebo-classic/run_gazebo.sh`脚本，既未提供脚本的创建方法，也未提及该脚本的存在。
    - 错误点：用户按教程执行命令后，`sim_vehicle.py`无法拉起Gazebo，直接导致Gazebo窗口不弹出、飞控启动后无仿真器连接，永久`link 1 down`，这是你核心问题的根源。
2.  **启动时序完全错误，未明确关键等待条件**
    教程6.2节给出了多终端启动流程，但完全未明确每个步骤的等待条件：必须等终端1飞控显示`Ready to FLY`、完成EKF初始化与GPS锁定后，才能启动终端2的MAVROS节点。
    - 错误点：用户按教程顺序执行，未等飞控初始化完成就启动MAVROS，必然导致MAVROS无法连接飞控，教程缺失关键的启动时序与分步成功标志说明。
3.  **模型/文件命名与官方仓库实际内容完全不符**
    教程4.2节、5.2节、5.3节均引导使用`iris`模型和`iris.world`世界文件，但ArduPilot_Gazebo官方仓库内，带完整ArduPilot插件配置的模型名为`iris_with_ardupilot`，世界文件名为`iris_with_ardupilot.world`。
    - 错误点：教程完全未说明该命名差异，也未提供重命名步骤，用户按教程执行cp命令必然触发`没有那个文件或目录`报错，导致模型加载失败。
4.  **缺失高频场景的前置清理步骤**
    教程所有启动步骤前，均未提供残留进程清理命令，用户反复启动仿真时，gzserver、arducopter、mavproxy.py等进程残留，会占用9002/9003/5760等核心端口，直接导致仿真启动失败、link 1 down，教程完全未考虑该高频故障场景。
5.  **缺失MAVProxy前置安装步骤**
    教程4.3节的`sim_vehicle.py`脚本强依赖MAVProxy地面站工具，但教程完全未提前说明MAVProxy的安装方法，用户执行脚本会直接触发`mavproxy.py: 未找到命令`报错，仿真启动直接中断。

## 四、版本兼容与细节缺失，埋下大量隐性故障
1.  **未明确分支与版本的兼容性要求**
    教程1.3节推荐使用Copter-4.5稳定分支，但未说明该分支的`Tools/simulation/gazebo-classic`目录结构与master分支不同，部分子模块文件缺失，也未提供文件补全方法；同时未明确ArduPilot_Gazebo仓库与ArduPilot固件分支的匹配要求，用户克隆master分支插件后，与Copter-4.5固件存在兼容性问题。
2.  **未提及Gazebo与Wayland协议的兼容问题**
    教程完全未提及Ubuntu 22.04默认的Wayland显示协议与Gazebo 11存在严重渲染兼容问题，会导致Gazebo黑屏、窗口崩溃、shader库找不到等问题，也未提供`QT_QPA_PLATFORM=xcb`的修复方案，用户遇到该问题时完全无排查方向。
3.  **缺失分步验证环节，无法定位故障节点**
    教程仅给出最终的成功标志，未提供分步验证方法：比如先单独启动Gazebo验证模型/插件加载，再启动飞控验证通信链路，最后启动MAVROS验证ROS连接。用户一键启动失败后，无法定位是Gazebo、飞控还是MAVROS的问题，排查完全无方向。
4.  **未明确脚本的运行环境要求**
    教程4.3节仅说明要在ArduPilot根目录执行`sim_vehicle.py`脚本，但未明确必须用python3执行，也未说明脚本的运行依赖，用户在错误的环境、错误的路径执行时，会触发一系列无明确提示的隐性报错。
